# HTTP

HTTP（Hypertext Transfer Protocol, 超文本传输协议）是客户端与服务器进行数据传输时使用的协议. HTTP 默认工作在 TCP 的 80 端口.

HTTP 以明文方式发送内容, 如果攻击者截取了客户端和服务器之间传输的报文, 就可以直接读取其中的信息.

HTTP 是无状态的, 服务器不会保存客户端的状态信息. 为了处理状态, 通常使用 Cookie 来维护客户端和服务器之间的状态.

<br>

## HTTP 1.1

HTTP 1.1 默认是无连接的, 客户端每次请求都需要与服务器建立一个 TCP 连接, 服务器处理完成后立即断开.

HTTP 1.1 可配置长连接（也称为持久连接）, 通过设置报文首部 `Connection: keep-alive` 可以保持连接不断开, 避免每次客户端请求服务器都要重复建立、断开 TCP 连接.

HTTP 1.1 是基于文本格式的, 每次请求、响应传递的都是纯文本（字符串）, 并且文本格式必需按照 HTTP 规定的格式书写.

<br>

## HTTP 2

HTTP 2 是 HTTP 1.1 的升级版, 它兼容 HTTP 1.1 的同时, 在性能、效率和安全方面有着显著的改进:

1. 多路复用（Multiplexing）: HTTP 2 支持在单个 TCP 连接上同时发送多个请求和接收多个响应, 通过多路复用减少了连接建立和关闭的开销.

2. 二进制传输（Binary Framing）: HTTP 2 使用二进制格式对数据进行帧封装和传输, 取代了原来的文本格式. 这种二进制格式的编码和解码更高效.

3. 头部压缩（Header Compression）: HTTP 2 使用 HPACK 压缩算法对请求头、响应头进行压缩, 减少了数据的传输量. 压缩后的头部信息可在客户端和服务器之间进行缓存和重用.

4. 服务器推送（Server Push）: HTTP 2 支持服务器主动推送资源给客户端. 服务器可以根据请求的资源关联性提前推送相关资源.

5. 流量控制（Flow Control）: HTTP 2 允许客户端和服务器之间对数据流的流量进行控制, 防止过载和拥塞.

6. 请求优先级（Priority）: HTTP 2 支持对请求设置优先级, 以确保重要资源的优先传输.

7. 头部重置（Header Reset）: HTTP 2 允许客户端和服务器重置之前发送的头部信息, 以提高错误处理和恢复的能力.

<br><br>

# HTTPS

HTTPS（Hypertext Transfer Protocol Secure, 超文本传输安全协议）经由 HTTP 通信, 利用 SSL(安全套接层) / TLS(传输层安全) 加密数据. HTTPS 默认工作在 TCP 的 443 端口.

浏览器会希望, 通过 https 协议拿到的网页中, 其他资源均应该使用 https 协议获取.

<br>

HTTPS 通过对称加密、非对称加密以及数字证书 3 者的结合, 提供了一种安全的网络通信机制. 下面是 HTTPS 的工作原理:

1. **开始通信**: 当客户端（比如浏览器）尝试与 HTTPS 网站建立连接时, 它首先会向服务器发送一个请求, 要求服务器提供一个公钥.

2. **获取证书**: 服务器会将一个包含公钥的数字证书响应给客户端. 这个数字证书由一个受信任的第三方机构（称为证书颁发机构 CA）签发.

3. **验证证书**: 客户端会验证这个数字证书的有效性. 如果证书是由一个受信任的 CA 签发的, 并且证书中的信息（如证书的有效期、签名等）都是正确的, 那么客户端就会信任这个证书.

4. **生成会话密钥**: 一旦客户端信任了服务器的证书, 它就会生成一个随机的对称密钥（也称为会话密钥）, 然后用服务器的公钥对这个会话密钥进行加密, 再将加密后的会话密钥发送给服务器.

5. **解密会话密钥**: 服务器收到加密的会话密钥后, 会用自己的私钥对其进行解密, 得到会话密钥. 这样, 客户端和服务器就共享一个会话密钥了.

6. **加密通信**: 之后, 客户端和服务器就可以用这个会话密钥对他们之间传输的所有数据进行加密. 这样, 即使数据在传输过程中被拦截, 攻击者也无法读取或修改数据, 因为他们没有会话密钥.

以上就是 HTTPS 的工作原理.

<br><br>

# 三握四挥

"三握四挥" 是 TCP 协议中建立和断开连接的过程.

<br>

三次握手:

-   第一步: 客户端发送一个请求给服务器, 询问是否可以建立连接.
-   第二步: 服务器收到请求后, 回复客户端, 表示可以建立连接.
-   第三步: 客户端收到服务器的回复后, 再次回复服务器, 确认连接建立.

<br>

四次挥手:

-   第一步: 客户端发送请求给服务器, 请求断开连接.
-   第二步: 服务器接收到请求后, 回复客户端, 表示收到了请求, 但还没有准备好断开连接.
-   第三步: 服务器准备好断开连接时, 发送请求给客户端, 告诉客户端可以断开连接.
-   第四步: 客户端收到服务器的请求后, 回复服务器, 确认断开连接.

<br>

通过 "三握四挥" 的过程, 客户端和服务器建立和断开连接时都进行了双方的确认, 确保连接的可靠性和准确性. 这种方式可以保证数据的正确传输, 并且在断开连接时, 双方都能安全地关闭连接.

<br>
