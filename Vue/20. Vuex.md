# Vuex ç®€ä»‹

Vuex æ˜¯å®˜æ–¹æä¾›çš„ä¸€ä¸ªæ’ä»¶ï¼Œç”¨äºé›†ä¸­å¼ç®¡ç†ç»„ä»¶å…±ç”¨çš„æ•°æ®ã€‚ä½¿ç”¨ Vuex åï¼Œä»»ä½•ç»„ä»¶ä¹‹é—´éƒ½å¯ä»¥è¿›è¡Œé€šä¿¡ã€‚Vuex çš„æ•°æ®å­˜å‚¨æ˜¯å“åº”å¼çš„ï¼Œå½“ç»„ä»¶ä» store ä¸­è·å–å¹¶æ”¹å˜æ•°æ®æ—¶ï¼Œæ¨¡ç‰ˆä¼šè¢«é‡æ–°æ¸²æŸ“ã€‚

<br>

<img src="./picture/bd75e31c2a1e4ac99b8a400a0523da92.png" alt="img" style="zoom: 67%;" />

1. State (çŠ¶æ€)ï¼šç”¨äºå­˜å‚¨æ•°æ®ã€‚å­˜å‚¨çš„æ•°æ®ä¾› Vue Components ä½¿ç”¨ã€‚
2. Vue Components (ç»„ä»¶)ï¼šä¸ç”¨æˆ·äº¤äº’ï¼Œå°†æ›´æ–°çš„æ•°æ® Dispatch(å‘é€) ç»™ Actions
3. Action**s** (è¡ŒåŠ¨)ï¼šå¤„ç†äº¤äº’è¡Œä¸ºï¼Œå°†æ›´æ–°çš„æ•°æ® Commit(æäº¤) åˆ° Mutationsã€‚å¯å¤„ç† [åŒæ­¥] & [å¼‚æ­¥] æ“ä½œã€‚
4. Mutation**s** (å˜åŒ–)ï¼š**æ›´æ–° State ä¸­çš„æ•°æ®ï¼Œå°½å¯èƒ½ä¸åšé€»è¾‘å¤„ç†**ã€‚åªå¤„ç† [åŒæ­¥] æ“ä½œã€‚

-   å¦‚æœåªæœ‰ [åŒæ­¥] æ“ä½œï¼ŒVue Components å¯ä»¥ç›´æ¥æ“ä½œ Mutationsï¼Œè¿›è€Œä¿®æ”¹ State é‡Œé¢çš„æ•°æ®ã€‚

<br><br>

# Vuex çš„ä½¿ç”¨

**ç¬¬ä¸€æ­¥ï¼šä¸‹è½½ vuex**

```bash
npm i vuex
```

æ³¨æ„ç‰ˆæœ¬é—®é¢˜ï¼švuex3 - vue2ã€vuex4 - vue3

<br>

**ç¬¬äºŒæ­¥ï¼šé…ç½® store æ–‡ä»¶**

åˆ›å»ºã€é…ç½® @/store/index.js æ–‡ä»¶ï¼š

```js
import Vue from 'vue';
import Vuex from 'vuex';

// è¯¥æŒ‡ä»¤å¿…é¡»åœ¨ store åˆ›å»ºä¹‹å‰æ‰§è¡Œ
Vue.use(Vuex);

// Actions(è¡ŒåŠ¨): å¤„ç†äº¤äº’è¡Œä¸º
const actions = {
    // context: ç®€åŒ–ç‰ˆçš„ store;  value: å‘é€è¿‡æ¥çš„æ•°æ®
    changeDispatch(context, value) {
        console.log('actions', context, value);
        // å°†æ•°æ® commit ç»™ mutations
        // è®¾ç½® 2 ä¸ªå®å‚: commit ä¸­çš„æ–¹æ³•å & å‘é€çš„æ•°æ®
        context.commit('changeCommit', value);
    },
};

// Mutations(å˜åŒ–): ä¿®æ”¹ state ä¸­çš„æ•°æ®
const mutations = {
    // state: å­˜å‚¨çš„æ•°æ®;  value: å‘é€çš„æ•°æ®
    changeCommit(state, value) {
        console.log('mutations', state, value);
        // ä¿®æ”¹ state ä¸­å­˜å‚¨çš„æ•°æ®;  ä¿®æ”¹åï¼Œé¡µé¢ä¼šé‡æ–°æ¸²æŸ“
        state.name = value;
    },
};

// State: ç”¨äºå­˜å‚¨æ•°æ®
const state = { name: 'superman' };

// åˆ›å»ºå¹¶å¯¼å‡º store
export default new Vuex.Store({
    actions,
    mutations,
    state,
});
```

<br>

**ç¬¬ä¸‰æ­¥ï¼šåœ¨å…¥å£æ–‡ä»¶ main.js ä¸­æ³¨å†Œ store æ–‡ä»¶**

```js
import Vue from 'vue';
import App from './App.vue';
import store from './store'; // å¼•å…¥ store æ–‡ä»¶

new Vue({
    store, // æ³¨å†Œ store
    render: (h) => h(App),
}).$mount('#app');
```

æ³¨å†Œå®Œ store æ–‡ä»¶åï¼Œç»„ä»¶å®ä¾‹èº«ä¸Šå°±ä¼šæœ‰ `$store` å±æ€§ï¼Œå¯é€šè¿‡ `$store` å±æ€§è·å–å¹¶ä¿®æ”¹ store ä¸­å­˜å‚¨çš„æ•°æ®ã€‚

```vue
<template>
    <div>
        <p>name: {{ $store.state.name }}</p>
        <button @click="changeName">ç‚¹å‡»ä¿®æ”¹ state ä¸­çš„æ•°æ®</button>
    </div>
</template>

<script>
export default {
    name: 'App',
    methods: {
        changeName() {
            // åœ¨ç»„ä»¶ä¸­ å°†æ•°æ® dispatch ç»™ Actions
            // ä¼ å…¥ 2 ä¸ªå®å‚: dispatch ä¸­çš„æ–¹æ³•å & å‘é€çš„æ•°æ®
            this.$store.dispatch('changeDispatch', 'superVue');
        },
    },
};
</script>
```

å»ºè®® `[this.]$store.state.XXX` æ”¾åœ¨è®¡ç®—å±æ€§ä¸­ï¼š

```vue
<template>
    <div id="app">
        <p>name: {{ getName }}</p>
        <button @click="changeName">ç‚¹å‡»ä¿®æ”¹ state ä¸­çš„æ•°æ®</button>
    </div>
</template>

<script>
export default {
    name: 'App',
    methods: {
        changeName() {
            // åœ¨ç»„ä»¶ä¸­ å°†æ•°æ® dispatch ç»™ Actions
            // ä¼ å…¥ 2 ä¸ªå®å‚: dispatch ä¸­çš„æ–¹æ³•å & å‘é€çš„æ•°æ®
            this.$store.dispatch('changeDispatch', 'superVue');
        },
    },
    computed: {
        getName() {
            return this.$store.state.name;
        },
    },
};
</script>
```

<br>

**å¯¹äºåŒæ­¥æ“ä½œï¼š**

-   å¦‚æœåªæœ‰åŒæ­¥æ“ä½œï¼ŒVue Components å¯ä»¥ç›´æ¥å°†æ•°æ® commit åˆ° Mutationsï¼Œè¿›è€Œå¤„ç† State é‡Œé¢å­˜å‚¨çš„æ•°æ®
-   å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä¸€æ­¥ä¸€æ­¥æ¥ï¼šVue Components - Dispatch ğŸ‘‰ Actions - Commit ğŸ‘‰ Mutations

```vue
<template>
    <div id="app">
        <p>name: {{ getName }}</p>
        <button @click="changeName">ç‚¹å‡»ä¿®æ”¹ state ä¸­çš„æ•°æ®</button>
    </div>
</template>

<script>
export default {
    name: 'App',
    methods: {
        changeName() {
            // åœ¨ç»„ä»¶ä¸­ å°†æ•°æ® commit ç»™ Mutations
            // ä¼ å…¥ 2 ä¸ªå‚æ•°: commit ä¸­çš„æ–¹æ³•å & å‘é€çš„æ•°æ®
            this.$store.commit('changeCommit', 'superVue');
        },
    },
    computed: {
        getName() {
            return this.$store.state.name;
        },
    },
};
</script>
```

å¦‚æœéœ€è¦ä¼ é€’å¤šä¸ªæ•°æ®ï¼Œåº”è¯¥å†™æˆä¸€ä¸ªå¯¹è±¡ï¼š

```js
changeName() {
    this.$store.commit("changeCommit", {
        name: "superVue",
    });
},
```

```js
mutations: {
    increment(state, payload) {
        state.name += payload.amount;
    },
},
```

å¯¹è±¡é£æ ¼çš„æäº¤æ–¹å¼ï¼š

```js
changeName() {
    this.$store.commit({
        type: "changeCommit", // ä½¿ç”¨ type å­—æ®µæŒ‡å®š mutations ä¸­çš„æ–¹æ³•å
        name: "superVue",
    });
},
```

æ­¤æ—¶ï¼Œæ•´ä¸ªå¯¹è±¡éƒ½ä½œä¸ºè½½è·ä¼ ç»™ mutations å‡½æ•°

<br>

**ä¸€äº›ä¸ª summaryï¼š**

1. Vue Components ä¸­è·å– State ä¸­çš„æ•°æ®ï¼š`{{$store.state.å±æ€§å}}` || `this.$store.state.å±æ€§å`
2. Vue Components é€šè¿‡ `this.$store.dispatch("actionsäº‹ä»¶å"[, æ•°æ®])` æ‰§è¡ŒåŒæ­¥ / å¼‚æ­¥æ“ä½œ
3. åŒæ­¥ä»£ç ä¿®æ”¹ state ä¸­çš„æ•°æ®ï¼š
    - Actions ä¸­ï¼šé€šè¿‡ `context.commit("mutationsäº‹ä»¶å"[, æ•°æ®])` æ‰§è¡ŒåŒæ­¥æ“ä½œ
    - Vue Components ä¸­ï¼šé€šè¿‡ `this.context.commit("mutationsäº‹ä»¶å"[, æ•°æ®])` æ‰§è¡ŒåŒæ­¥æ“ä½œ

<br><br>

# getters

-   ç”¨äºå¯¹ state ä¸­çš„æ•°æ®è¿›è¡ŒåŠ å·¥ï¼Œç±»ä¼¼ç»„ä»¶ä¸­çš„**è®¡ç®—å±æ€§ computed**
-   Vue Components è·å– getters ä¸­çš„æ•°æ®ï¼š`[this.]$store.getters.å±æ€§å`
-   å½“å‰ä»“åº“çš„ `state` ä¼šä½œä¸º getters æ–¹æ³•çš„ç¬¬ 1 å‚æ•°ä¼ å…¥

```js
import Vue from 'vue';
import Vuex from 'vuex';

Vue.use(Vuex);

const actions = {};

const mutations = {};

// è®¾ç½® getters å¯¹è±¡
const getters = {
    // state ä¼šä½œä¸ºç¬¬ 1 å‚æ•°ä¼ å…¥ï¼ï¼ï¼
    gettersArr(state) {
        return state.arr.filter((item) => {
            if (item.id % 2 == 0) return item;
        });
    },
};

const state = {
    arr: [
        { id: 0, name: 'JS' },
        { id: 1, name: 'Java' },
        { id: 2, name: 'Python' },
        { id: 3, name: 'C++' },
    ],
};

export default new Vuex.Store({
    actions,
    mutations,
    state,
    getters,
});
```

```vue
<template>
    <div id="app">
        <ul>
            <li v-for="item of computedArr" :key="item.id">
                {{ item.id }}--{{ item.name }}
            </li>
        </ul>
    </div>
</template>

<script>
export default {
    name: 'App',
    computed: {
        computedArr() {
            // åœ¨ç»„ä»¶ä¸­è·å– getters ä¸­çš„æ•°æ®
            return this.$store.getters.gettersArr;
        },
    },
};
</script>
```

<br><br>

# è¾…åŠ©å‡½æ•°

æ¯æ¬¡åœ¨æ¨¡æ¿ä¸­è®¿é—® store æ–‡ä»¶ä¸­çš„æ•°æ® / æ–¹æ³•æ—¶ï¼Œéƒ½éœ€è¦ç”¨ä¸€å¤§ä¸²ä»£ç è·å– (eg: `[this.]$store.dispatch()`)ï¼Œéå¸¸ä¸æ–¹ä¾¿ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¾…åŠ©å‡½æ•°

<br>

## mapState

-   mapState å¯ä»¥å¸®åŠ©æˆ‘ä»¬ç”Ÿæˆ**è®¡ç®—å±æ€§**ï¼Œæ–¹ä¾¿æˆ‘ä»¬è·å– state ä¸­çš„æ•°æ®
-   mapState çš„å‚æ•°å¯ä»¥æ˜¯ [å¯¹è±¡] / [æ•°ç»„]

```vue
<template>
    <div class="app">
        <p>name: {{ staName }}</p>
        <p>gender: {{ staGender }}</p>
        <p>age: {{ staAge }}</p>
    </div>
</template>

<script>
import { mapState } from 'vuex'; // å¼•å…¥ mapState
export default {
    name: 'App',
    computed: {
        // å‚æ•°æ˜¯å¯¹è±¡: å±æ€§åä¸ºç›¸å½“äº computed çš„å±æ€§åï¼Œå±æ€§å€¼ä¸º state å¯¹è±¡çš„å±æ€§å
        ...mapState({
            staName: 'name',
            staGender: 'gender',
            staAge: 'age',
        }),
        // å› ä¸º mapState è¿”å›çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥è¦ç”¨ ... å°†å…¶ä¸ computed åˆå¹¶
    },
};
</script>
```

-   mapState çš„å‚æ•°æ˜¯å¯¹è±¡ï¼Œå¦‚æœè¦å¯¹æ•°æ®è¿›è¡Œé¢å¤–æ“ä½œï¼Œå¯¹è±¡å±æ€§çš„å±æ€§å€¼è¿˜å¯ä»¥ä¸º [å‡½æ•°] å½¢å¼ï¼›

```js
import { mapState } from 'vuex';
export default {
    name: 'App',
    data() {
        return { num: 1 };
    },
    computed: {
        ...mapState({
            // æ­¤æ—¶ï¼Œstore çš„ `state` ä¼šä½œä¸ºç¬¬ 1 å‚æ•°ä¼ å…¥
            staName: (state) => state.name, // ç®­å¤´å‡½æ•°
            staGender: (state) => state.gender.toUpperCase(),
            // å¦‚æœè¦è·å– this, é‚£è¿˜æ˜¯è€è€å®å®å†™æ™®é€šå‡½æ•°å§
            staAge(state) {
                return state.age + this.num;
            },
        }),
    },
};
```

-   mapState çš„å‚æ•°æ˜¯å¯¹è±¡ï¼Œå½“è¯¥å¯¹è±¡çš„å±æ€§å€¼ä¸å±æ€§åä¸€æ ·æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ•°ç»„ä½œä¸ºå‚æ•°

```vue
<template>
    <div class="app">
        <p>name: {{ name }}</p>
        <p>gender: {{ gender }}</p>
        <p>age: {{ age }}</p>
    </div>
</template>

<script>
import { mapState } from 'vuex'; // å¼•å…¥ mapState
export default {
    name: 'App',
    computed: {
        // ä½¿ç”¨æ•°ç»„ä½œä¸ºå‚æ•°
        ...mapState(['name', 'gender', 'age']),
        // ç›¸å½“äº
        // ...mapState({ name: "name", gender: "gender", age: "age" }),
        // æ³¨æ„: è¿™ç§æƒ…å†µä¸‹ï¼Œä¸èƒ½ä½¿ç”¨ ES6 çš„å¯¹è±¡ç®€å†™ï¼Œå› ä¸ºå±æ€§å€¼æ˜¯å­—ç¬¦ä¸²ï¼Œä¸æ˜¯å˜é‡
    },
};
</script>
```

ä¸Šä¾‹çš„ store æ–‡ä»¶ï¼š

```js
import Vuex from 'vuex';
import Vue from 'vue';

Vue.use(Vuex);

const actions = {};
const mutations = {};
const state = {
    name: 'superman',
    gender: 'male',
    age: 21,
};

export default new Vuex.Store({
    actions,
    mutations,
    state,
});
```

<br>

## mapGetters

-   mapGetters å¯ä»¥å¸®åŠ©æˆ‘ä»¬ç”Ÿæˆ**è®¡ç®—å±æ€§**ï¼Œæ–¹ä¾¿æˆ‘ä»¬è·å– getters ä¸­çš„æ•°æ®
-   mapGetters çš„å‚æ•°å¯ä»¥æ˜¯ [å¯¹è±¡] / [æ•°ç»„]

```vue
<template>
    <div class="app">
        <h1>App</h1>
        <ul>
            <!-- å¯ä»¥åœ¨æ¨¡æ¿ä¸­ç›´æ¥ä½¿ç”¨ computedArr è·å– store ä¸­ getters çš„æ•°æ® -->
            <li v-for="item of computedArr" :key="item.id">
                {{ item.id }} -- {{ item.name }}
            </li>
        </ul>
    </div>
</template>

<script>
import { mapGetters } from 'vuex'; // å¼•å…¥ mapGetters
export default {
    name: 'App',
    computed: {
        // å‚æ•°æ˜¯å¯¹è±¡ï¼šå±æ€§åç›¸å½“äº computed çš„å±æ€§åï¼Œå±æ€§å€¼ä¸º getters å¯¹è±¡çš„å±æ€§å
        ...mapGetters({ computedArr: 'computedArr' }),
        // å› ä¸º mapGetters è¿”å›çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥è¦ç”¨ ... å°†å…¶ä¸ computed åˆå¹¶
    },
};
</script>
```

-   mapGetters çš„å‚æ•°æ˜¯å¯¹è±¡ï¼Œå½“è¯¥å¯¹è±¡çš„å±æ€§å€¼ä¸å±æ€§åä¸€æ ·æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ•°ç»„ä½œä¸ºå‚æ•°

```js
    computed: {
        // ä½¿ç”¨æ•°ç»„ä½œä¸ºå‚æ•°
        ...mapGetters(["computedArr"])
        // ç›¸å½“äº
        // ...mapGetters({ computedArr: "computedArr" }),
        // æ³¨æ„: è¿™ç§æƒ…å†µä¸‹ï¼Œä¸èƒ½ä½¿ç”¨ ES6 çš„å¯¹è±¡ç®€å†™ï¼Œå› ä¸ºå±æ€§å€¼æ˜¯å­—ç¬¦ä¸²ï¼Œä¸æ˜¯å˜é‡
    },
```

ä¸Šä¾‹çš„ store æ–‡ä»¶ï¼š

```js
import Vuex from 'vuex';
import Vue from 'vue';

Vue.use(Vuex);

const actions = {};
const mutations = {};
const getters = {
    computedArr(state) {
        return state.arr.filter((item) => {
            if (item.id % 2 == 0) return item;
        });
    },
};
const state = {
    arr: [
        { id: 0, name: 'JS' },
        { id: 1, name: 'Java' },
        { id: 2, name: 'Python' },
        { id: 3, name: 'C++' },
    ],
};

export default new Vuex.Store({
    actions,
    mutations,
    state,
    getters,
});
```

<br>

## mapMutations

-   mapMutations å¸®åŠ©æˆ‘ä»¬ç”Ÿæˆå¯¹åº”**æ–¹æ³•**ï¼Œæ–¹æ³•ä¸­ä¼šè°ƒç”¨ commit è”ç³» Mutations

```vue
<template>
    <div class="app">
        <p>numï¼š{{ num }}</p>
        <button @click="add">add</button>
        <button @click="reduce">reduce</button>
    </div>
</template>

<script>
import { mapState, mapMutations } from 'vuex'; // å¼•å…¥ mapStateã€mapMutations
export default {
    name: 'App',
    computed: {
        ...mapState(['num']),
    },
    methods: {
        ...mapMutations({ add: 'muAdd', reduce: 'muReduce' }),
        // if å±æ€§å == å±æ€§å€¼ï¼Œå‚æ•°å¯ä»¥å†™æˆæ•°ç»„å½¢å¼
        // ...mapMutations(["add", "reduce"]),
        // ç›¸å½“äº
        // ...mapGetters({ add: "add", reduce: "reduce" }),
        // æ³¨æ„: è¿™ç§æƒ…å†µä¸‹ï¼Œä¸èƒ½ä½¿ç”¨ ES6 çš„å¯¹è±¡ç®€å†™ï¼Œå› ä¸ºå±æ€§å€¼æ˜¯å­—ç¬¦ä¸²ï¼Œä¸æ˜¯å˜é‡
    },
};
</script>
```

```js
import Vuex from 'vuex';
import Vue from 'vue';

Vue.use(Vuex);

const actions = {};
const mutations = {
    muAdd(state, val = 1) {
        state.num += val;
    },
    muReduce(state, val = 1) {
        state.num -= val;
    },
};
const state = { num: 21 };

export default new Vuex.Store({
    actions,
    mutations,
    state,
});
```

æ­¤æ—¶ï¼Œå¦‚æœæƒ³ä¼ å…¥å‚æ•°ï¼Œå¯ä»¥åœ¨è°ƒç”¨å‡½æ•°æ—¶ä¸€å¹¶ä¼ å…¥

```vue
<template>
    <div class="app">
        <p>num: {{ num }}</p>
        <!-- è°ƒç”¨æ–¹æ³•çš„æ—¶å€™ï¼Œä¸€å¹¶ä¼ å…¥å‚æ•° -->
        <button @click="add(2)">add 2</button>
        <button @click="reduce(2)">reduce 2</button>
    </div>
</template>

<script>
import { mapState, mapMutations } from 'vuex';
export default {
    name: 'App',
    computed: {
        ...mapState(['num']),
    },
    methods: {
        ...mapMutations({ add: 'muAdd', reduce: 'muReduce' }),
    },
};
</script>
```

æˆ–è€…ï¼Œè°ƒç”¨è‡ªèº«æ–¹æ³•ï¼Œå†è°ƒç”¨ mapMutations çš„æ–¹æ³•ã€å¹¶ä¼ å…¥å‚æ•°

```vue
<template>
    <div class="app">
        <p>num: {{ num }}</p>
        <!-- è°ƒç”¨è‡ªèº«æ–¹æ³• -->
        <button @click="myAdd">add 2</button>
        <button @click="myReduce">reduce 2</button>
    </div>
</template>

<script>
import { mapState, mapMutations } from 'vuex';
export default {
    name: 'App',
    computed: {
        ...mapState(['num']),
    },
    methods: {
        // åœ¨è‡ªèº«æ–¹æ³•ä¸­è°ƒç”¨ mapMutations çš„æ–¹æ³•ã€å¹¶ä¼ å…¥å‚æ•°
        myAdd() {
            this.add(2);
        },
        myReduce() {
            this.reduce(2);
        },
        ...mapMutations({ add: 'muAdd', reduce: 'muReduce' }),
    },
};
</script>
```

<br>

## mapActions

-   mapActions å¸®åŠ©æˆ‘ä»¬ç”Ÿæˆå¯¹åº”**æ–¹æ³•**ï¼Œæ–¹æ³•ä¸­ä¼šè°ƒç”¨ dispatch è”ç³» Actions

```vue
<template>
    <div>
        <p>num: {{ num }}</p>
        <!-- è°ƒç”¨æ–¹æ³•çš„æ—¶å€™ï¼Œä¸€å¹¶ä¼ å…¥å‚æ•° -->
        <button @click="add(2)">add 2</button>
        <!-- è°ƒç”¨è‡ªèº«æ–¹æ³• -->
        <button @click="myReduce">reduce 2</button>
    </div>
</template>

<script>
import { mapState, mapActions } from 'vuex';
export default {
    name: 'App',
    computed: {
        ...mapState(['num']),
    },
    methods: {
        // åœ¨è‡ªèº«æ–¹æ³•ä¸­ï¼Œè°ƒç”¨ mapActions ä¸­çš„æ–¹æ³•å¹¶ä¼ å…¥å‚æ•°
        myReduce() {
            this.reduce(2);
        },
        ...mapActions({ add: 'acAdd', reduce: 'acReduce' }),
    },
};
</script>
```

```js
import Vuex from 'vuex';
import Vue from 'vue';

Vue.use(Vuex);

const actions = {
    acAdd(context, value) {
        context.commit('muAdd', value);
    },
    acReduce(context, value) {
        context.commit('muReduce', value);
    },
};
const mutations = {
    muAdd(state, value) {
        state.num += value;
    },
    muReduce(state, value) {
        state.num -= value;
    },
};
const state = { num: 21 };

export default new Vuex.Store({
    actions,
    mutations,
    state,
});
```

<br><br>

# è·å–é¡µé¢æ•°æ®

1. é€šè¿‡é’©å­å‡½æ•° `mounted` è°ƒç”¨ Actions çš„æ–¹æ³•
2. åœ¨ Actions ä¸­å‘é€ Ajax è·å–é¡µé¢æ‰€éœ€æ•°æ®ï¼Œå¹¶è°ƒç”¨ Mutations çš„æ–¹æ³•
3. åœ¨ Mutations ä¸­ä¿®æ”¹ State çš„æ•°æ®ï¼Œä»¥å­˜å‚¨ Ajax è·å–åˆ°çš„æ•°æ®

<br><br>

# æ¨¡å—åŒ– store æ–‡ä»¶

1. åˆ›å»ºå¤šä¸ª store æ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶è´Ÿè´£æŒ‡å®šæ¨¡å—åŠŸèƒ½çš„æ•°æ®åŠå…¶æ“ä½œæ–¹æ³•
2. å°†æ¨¡å—åŒ–åçš„ store æ–‡ä»¶ï¼Œå¯¼å…¥åˆ°ä¸» store æ–‡ä»¶ï¼Œå†é›†ä¸­å¯¼å‡º

```bash
store
â”œâ”€â”€ count.js // è®¡æ•°å™¨æ¨¡å—
â”œâ”€â”€ index.js // ä¸» store æ–‡ä»¶
â””â”€â”€ show.js // æ˜¾ç¤º / éšè—æ¨¡å—
```

-   å¯¹äºæ¨¡å—å†…éƒ¨çš„ `mutation` å’Œ `getter`ï¼Œæ¥æ”¶çš„ç¬¬ 1 ä¸ªå‚æ•°æ˜¯æ¨¡å—çš„å±€éƒ¨çŠ¶æ€å¯¹è±¡
-   åŒæ ·ï¼Œå¯¹äºæ¨¡å—å†…éƒ¨çš„ `action`ï¼Œå±€éƒ¨çŠ¶æ€é€šè¿‡ `context.state` æš´éœ²å‡ºæ¥ï¼Œæ ¹èŠ‚ç‚¹çŠ¶æ€åˆ™ä¸º `context.rootState`
-   å¯¹äºæ¨¡å—å†…éƒ¨çš„ `getter`ï¼Œæ ¹èŠ‚ç‚¹çŠ¶æ€ä¼šä½œä¸ºç¬¬ 3 ä¸ªå‚æ•°æš´éœ²å‡ºæ¥

<br>

count.jsï¼š

```js
export default {
    namespaced: true, // è®¾ç½® namespacedï¼Œç”Ÿæˆå‘½åç©ºé—´
    // å¦‚æœä¸è®¾ç½® namespacedï¼Œstore ä¸­åªæœ‰ [state] è¢«åˆ†æ¨¡å—
    // [action]ã€ [mutation]ã€[getter] éƒ½è¿˜æ˜¯å…¨å±€æ•°æ®

    mutations: {
        add(state, value) {
            state.num += value;
        },
        reduce(state, value) {
            state.num -= value;
        },
    },
    state: { num: 0 },
};
```

åœ¨å¸¦å‘½åç©ºé—´çš„æ¨¡å—å†…è®¿é—®å…¨å±€å†…å®¹ï¼š
â‘  å¦‚æœä½ å¸Œæœ›ä½¿ç”¨å…¨å±€ `state` å’Œ `getter`ï¼Œ`rootState` å’Œ `rootGetters` ä¼šä½œä¸ºç¬¬ 3 å’Œç¬¬ 4 å‚æ•°ä¼ å…¥ `getter`ï¼›
â‘¡ `rootState` å’Œ `rootGetters` ä¹Ÿä¼šé€šè¿‡ `context` å¯¹è±¡çš„å±æ€§ä¼ å…¥ `action`ï¼›
â‘¢ è‹¥éœ€è¦åœ¨å…¨å±€å‘½åç©ºé—´å†…åˆ†å‘ `action` æˆ–æäº¤ `mutation`ï¼Œå°† `{ root: true }` ä½œä¸ºç¬¬ 3 å‚æ•°ä¼ ç»™ `dispatch` æˆ– `commit` å³å¯ã€‚

<br>

show.jsï¼š

```js
export default {
    namespaced: true, // è®¾ç½® namespaced ç”Ÿæˆå‘½åç©ºé—´
    state: {
        show: 1,
        name: 'superman',
        arr: [
            { id: 0, name: 'JS' },
            { id: 1, name: 'Java' },
            { id: 2, name: 'Python' },
            { id: 3, name: 'C++' },
        ],
    },
    actions: {
        acShow(context) {
            if (context.state.show) context.commit('muShow', 0);
            else context.commit('muShow', 1);
        },
    },
    mutations: {
        muShow(state, value) {
            state.show = value;
        },
    },
    getters: {
        computedArr(state) {
            return state.arr.filter((item) => {
                if (item.id % 2 == 0) return item;
            });
        },
    },
};
```

<br>

index.jsï¼š

å°†åŠŸèƒ½æ¨¡å—å¯¼å…¥ä¸» store æ–‡ä»¶ï¼Œå†åœ¨æ­¤é›†ä¸­å¯¼å‡ºï¼š

```js
import Vuex from 'vuex';
import Vue from 'vue';

Vue.use(Vuex);

// å¼•å…¥æ¨¡å—
import countAbout from './count';
import showAbout from './show';

export default new Vuex.Store({
    // æ¨¡å—åŒ–
    modules: {
        countAbout,
        showAbout,
    },
});
```

æ³¨æ„ï¼šåªæœ‰ä¸» store æ–‡ä»¶éœ€è¦å¯¼å…¥ vue å’Œ vuex

<br>

App.vueï¼š

-   è·å– state ä¸­çš„æ•°æ®ï¼š `[this.]$store.state.æ¨¡å—å.å±æ€§å`
-   è·å– getters ä¸­çš„æ•°æ®ï¼š `[this.]$store.getters['æ¨¡å—å/å±æ€§å']`
-   è°ƒç”¨æ–¹æ³•ï¼š `this.$store.commit("æ¨¡å—å/æ–¹æ³•å"[, æ•°æ®])` / `this.$store.dispatch("æ¨¡å—å/æ–¹æ³•å"[, æ•°æ®]);`

```vue
<template>
    <div class="app">
        <p>num: {{ $store.state.countAbout.num }}</p>
        <p>num: {{ num }}</p>
        <button @click="add">add 10</button>
        <button @click="reduce">reduce 10</button>
        <hr />
        <ul>
            <li
                v-for="item of $store.getters['showAbout/computedArr']"
                :key="item.id"
            >
                {{ item.id }} -- {{ item.name }}
            </li>
        </ul>
        <button @click="show">éšè— / æ˜¾ç¤º</button>
        <p :style="{ opacity: $store.state.showAbout.show }">
            name: {{ $store.state.showAbout.name }}
        </p>
    </div>
</template>

<script>
export default {
    name: 'App',
    computed: {
        num() {
            return this.$store.state.countAbout.num;
        },
    },
    methods: {
        add() {
            this.$store.commit('countAbout/add', 10); // æ¨¡å—åŒ–åï¼Œè°ƒç”¨æ–¹æ³•éœ€è¦æ·»åŠ æ¨¡å—åï¼ï¼ï¼ï¼ï¼ï¼
        },
        reduce() {
            this.$store.commit('countAbout/reduce', 10);
        },
        show() {
            this.$store.dispatch('showAbout/acShow');
        },
    },
};
</script>
```

å¦‚æœä½¿ç”¨è¾…åŠ©å‡½æ•°çš„è¯ï¼Œåˆ™ç¬¬ 1 å‚æ•°ä¸º `æ¨¡å—å`ï¼Œç¬¬ 2 å‚æ•°æ‰æ˜¯å¯¹åº”çš„ `å±æ€§å`ï¼š

-   è·å– state ä¸­çš„æ•°æ®ï¼š`mapState("æ¨¡å—å", ["å±æ€§å1", "å±æ€§å2"])`
-   è·å– getters ä¸­çš„æ•°æ®ï¼š`mapGetters("æ¨¡å—å", ["å±æ€§å1", "å±æ€§å2"])`
-   è°ƒç”¨æ–¹æ³•ï¼š`mapMutations("æ¨¡å—å", ["æ–¹æ³•å1", "æ–¹æ³•å2"])` / `mapActions("æ¨¡å—å", ["æ–¹æ³•å1", "æ–¹æ³•å2"])`

```vue
<template>
    <div class="app">
        <p>num: {{ num }}</p>
        <button @click="add(2)">add 2</button>
        <button @click="reduce(2)">reduce 2</button>
        <hr />
        <ul>
            <li v-for="item of computedArr" :key="item.id">
                {{ item.id }} -- {{ item.name }}
            </li>
        </ul>
        <button @click="acShow">éšè— / æ˜¾ç¤º</button>
        <p :style="{ opacity: show }">name: {{ name }}</p>
    </div>
</template>

<script>
import { mapState, mapGetters, mapMutations, mapActions } from 'vuex';
export default {
    name: 'App',
    computed: {
        ...mapState('countAbout', ['num', 'name']),
        ...mapState('showAbout', ['name', 'show']),
        ...mapGetters('showAbout', ['computedArr']),
    },
    methods: {
        ...mapActions('countAbout', { setData: 'setData' }), // ä½¿ç”¨å¯¹è±¡å¼å†™æ³•
        ...mapMutations('countAbout', ['add', 'reduce']), // ä½¿ç”¨æ•°ç»„å¼å†™æ³•
        ...mapActions('showAbout', { acShow: 'acShow' }),
    },
};
</script>
```

<br><br>

# ä¸€äº›æŠ¥é”™

`Uncaught TypeError: (0 , vue__WEBPACK_IMPORTED_MODULE_20__.reactive) is not a function`

è§£ï¼šç‰ˆæœ¬å…¼å®¹é—®é¢˜ï¼Œvue2 ä½¿ç”¨ vuex3ï¼›vue3 ä½¿ç”¨ vuex4

<br>

[vuex] unknown action type: XXX

è§£ï¼šæ¨¡å—åŒ– store æ—¶ï¼Œè°ƒç”¨ dispatch ç­‰æ–¹æ³•ï¼Œéœ€è¦æ·»åŠ æ¨¡å—å

<br>
