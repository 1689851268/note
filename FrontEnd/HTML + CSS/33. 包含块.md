# 包含块

包含块的英语全称为 containing block, 包含块分为两种:

一种是根元素 (HTML 元素) 所在的包含块, 被称之为初始包含块 (**initial containing block**). 对于浏览器而言, 初始包含块的的大小等于视口 viewport 的大小, 基点在画布的原点 (视口左上角). 它是作为元素绝对定位和固定定位的参照物.

另外一种是对于非根元素, 需要通过这个元素的 `position` 属性 (默认值为 `static`) 确定其包含块:

1. `static` / `relative` / `sticky`: 包含块由最近的祖先**块元素** (`inline-block` / `block`) 的**内容区域**的边缘建立.
2. `fixed`: 包含块由视口建立.
3. `absolute`: 包含块由最近的 `position` 的值不是 `static` 的祖先**元素**的**内边距区域**的边缘建立.

```html
<body>
    <div class="container">
        <div class="item">
            <div class="item2">对于 div.item2 来讲, 它的包含块应该是 div.container, 而非 div.item</div>
        </div>
    </div>
</body>
```

```css
.container {
    width: 500px;
    height: 300px;
    background-color: skyblue;
    position: relative;
}
.item {
    width: 300px;
    height: 150px;
    border: 5px solid;
    margin-left: 100px;
}
.item2 {
    width: 100px;
    height: 100px;
    background-color: red;
    position: absolute;
    left: 10px;
    top: 10px;
}
```

4. `absolute` / `fixed`: 包含块还可能由满足以下条件的最近的祖先**块元素**的**内边距区域**的边缘组成 (优先级较高)
    1. `filter` 的值不是 `none`, 或者 `will-change` 的值是 `filter`. (仅 Firefox 生效)
    2. `transform` / `perspective` 的值不是 `none`, 或者 `will-change` 的值是 `transform` / `perspective`.
    3. `contain` 的值是 `paint`.

```html
<body>
    <div class="container">
        <div class="item">
            <div class="item2">此时对于 div.item2 来讲, 包含块就变成了 div.item</div>
        </div>
    </div>
</body>
```

```css
.container {
    width: 500px;
    height: 300px;
    background-color: skyblue;
    position: relative;
}
.item {
    width: 300px;
    height: 150px;
    border: 5px solid;
    margin-left: 100px;
    transform: rotate(0deg); /* 新增代码 */
}
.item2 {
    width: 100px;
    height: 100px;
    background-color: red;
    position: absolute;
    left: 10px;
    top: 10px;
}
```

<br><br>

# 包含块的作用

包含块在 CSS 布局中起到以下关键作用:

1. **定位参考**: 元素的 `top`、`right`、`bottom`、`left` 等偏移属性是相对于其包含块计算的.

2. **尺寸计算**: 百分比宽度、高度、内边距和边距等属性的计算基于包含块的相应尺寸.

3. **层叠上下文**: 包含块影响 `z-index` 的作用范围, 决定元素的堆叠顺序.

4. **滚动容器**: 对于 `sticky` 定位元素, 包含块还影响其粘性行为.

<br><br>

# demo

```html
<html>
    <head>
        <title>Illustration of containing blocks</title>
    </head>
    <body id="body">
        <div id="div1">
            <p id="p1">This is text in the first paragraph...</p>
            <p id="p2">
                This is text
                <em id="em1">
                    in the
                    <strong id="strong1">second</strong>
                    paragraph.
                </em>
            </p>
        </div>
    </body>
</html>
```

上述代码在没有添加任何 CSS 代码的情况下, 各个元素的包含块如下:

| 元素    | 包含块                      |
| ------- | --------------------------- |
| html    | initial C.B. (UA-dependent) |
| body    | html                        |
| div1    | body                        |
| p1      | div1                        |
| p2      | div1                        |
| em1     | p2                          |
| strong1 | p2                          |

HTML 作为根元素, 对应的包含块就是前面我们所说的初始包含块; 对于 body 而言, 这是一个 static 定位的元素, 因此该元素的包含块参照非根元素包含块确定规则第 1 条, 为 html; 以此类推 div1、p1、p2 以及 em1 的包含块也都是它们的父元素;

为什么 strong1 的包含块是 p2 而不是 em1 呢? 再读一下非根元素包含块确定规则第 1 条: "包含块由最近的祖先**块元素** (`inline-block` / `block`) 的**内容区域**的边缘建立". 而 em1 不是块容器, 所以 strong1 的包含块是 p2.

<br>

接下来添加如下 CSS:

```css
#div1 {
    position: absolute;
    left: 50px;
    top: 50px;
}
```

我们对 div1 进行了定位, 现各个元素的包含块如下:

| 元素    | 包含块                      |
| ------- | --------------------------- |
| html    | initial C.B. (UA-dependent) |
| body    | html                        |
| div1    | initial C.B. (UA-dependent) |
| p1      | div1                        |
| p2      | div1                        |
| em1     | p2                          |
| strong1 | p2                          |

可以看到, 这里 div1 的包含块发生了变化, 变为了初始包含块.

因为我们对 div1 进行了定位, 因此它会应用非根元素包含块确定规则第 3 条, 寻找离它最近的 position 的值不是 static 的祖先元素, 不过显然 body 的定位方式为 static, 因此 div1 的包含块最终就变成了初始包含块.

<br>

继续修改 CSS:

```css
#div1 {
    position: absolute;
    left: 50px;
    top: 50px;
}
#em1 {
    position: absolute;
    left: 100px;
    top: 100px;
}
```

我们对 em1 同样进行了 absolute 绝对定位, 现各个元素的包含块如下:

| 元素    | 包含块                                                 |
| ------- | ------------------------------------------------------ |
| html    | initial C.B. (UA-dependent)                            |
| body    | html                                                   |
| div1    | initial C.B. (UA-dependent)                            |
| p1      | div1                                                   |
| p2      | div1                                                   |
| em1     | div1 (因为定位了, 参阅非根元素包含块确定规则的第 3 条) |
| strong1 | em1 (因为 em1 定位了, 其包含块将成为最近定位的元素)    |

<br>
