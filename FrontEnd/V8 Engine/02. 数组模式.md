<br>

V8 引擎中的数组模式是一种优化技术，用于提高 JavaScript 中数组操作的性能。

V8 引擎会根据数组的使用情况，将数组分为两种不同的模式：

1. **稀疏模式（Sparse Mode）**：当数组 "预分配数组长度大于 10 万，且数组有空洞" 时，V8 引擎会将数组标记为稀疏模式。在稀疏模式下，数组的内部实现是一个哈希表，它可以存储不连续的索引，但性能开销较大。

2. **密集模式（Packed Elements Mode）**：当数组 "索引从 0 到 length - 1 且无空洞" 或 "预分配数组长度小于 10 万，无论有没有空洞" 时，V8 引擎会将数组标记为密集模式。在密集模式下，数组的内部实现是一个连续的内存块，性能开销较小。

V8 引擎根据数组的使用情况动态地切换数组的模式，以实现更高效的数组操作。当数组从稀疏模式切换到密集模式时，V8 会对数组进行重新分配和数据复制，确保数组在密集模式下可以更快地进行连续索引的访问。

<br>

根据 V8 引擎的数组模式，我们可以采取一些优化措施来编写高效的 JavaScript 代码：

1. 尽量从 0 开始连续地初始化数组，以避免数组进入稀疏模式。
2. 不要预分配一个超大数组（比如长度大于 10 万的数组）。
3. 避免 `delete` 操作，因为使用 `delete` 操作符删除数组元素会导致稀疏数组的产生。如果需要删除数组元素，可以考虑使用 `splice` 方法，它可以在数组中直接删除元素，并保持数组的连续性。

<br>

```js
console.time("方案一");
const arr1 = [];
for (let i = 0; i < 1000000; i++) {
    arr1[i] = i;
}
console.timeEnd("方案一");

/* -------------------------------- */

console.time("方案二");
const arr2 = [];
arr2[1000000 - 1] = 0;
for (let i = 0; i < 1000000 - 1; i++) {
    arr2[i] = i;
}
console.timeEnd("方案二");
```

```
方案一: 17.284ms
方案二: 76.957ms
```
