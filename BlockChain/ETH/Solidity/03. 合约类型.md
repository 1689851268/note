# 合约类型

合约类型是一种特殊的地址类型. 合约类型和地址类型之间可以相互转换:

```solidity
contract Demo1 {}

contract Demo2 {
    Demo1 public demo1 = new Demo1();

    address public demo1Address = address(demo1);
    Demo1 public newDemo1 = Demo1(demo1Address);
}
```

在合约内部可以使用 `this` 表示当前合约:

```solidity
contract Demo {
    function getContractAddress() public view returns (address) {
        return address(this);
    }
}
```

<br><br>

# 获取合约信息

对于合约 C, 可以通过 `type(C)` 来获得合约信息:

```solidity
contract C {
    function f() public pure returns (string memory) {
        return "Hello";
    }
}

contract D {
    C public c = new C();

    function test()
        public
        pure
        returns (string memory, bytes memory, bytes memory)
    {
        return (type(C).name, type(C).creationCode, type(C).runtimeCode);
    }
}
```

<br><br>

# 区分合约地址与外部账号地址

操作者常常需要区分一个地址是合约地址还是外部账号地址. 关键在于看这个地址是否有与之相关联的代码. EVM 提供了操作码 EXTCODESIZE, 用于获取地址相关联的代码大小 (长度). 如果是外部账号地址, 则没有代码返回.

```solidity
contract Demo {
    function isContract(address addr) public view returns (bool) {
        uint256 size;
        assembly {
            size := extcodesize(addr)
        }
        return size > 0;
    }
}
```

如果在合约外部判断, 可以使用 Web3 的 API `web3.eth.getCode()` (或对应的 JSON-RPC 方法). `getCode()` 用于获取参数地址所对应合约的代码, 如果参数是外部账号地址, 则返回 "0x"; 如果参数是合约, 则返回对应的字节码. 通过对比 `getCode()` 的输出内容, 就可以轻松判断出是哪种地址.

<br><br>
